<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   <title> 오늘의 산책</title>
   
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
 
  <style>@view-transition { navigation: auto; }</style>
  

  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
  
  </head>
 <body>
  <div class="app-container">

   <header class="header">

    <div class="header-content">

     <div id="logo" class="logo" data-page="home" style="cursor: pointer;">
      <span style="font-size: 2rem;"></span>

      🌿 오늘의 산책

     </div>

     <nav class="nav"><button class="nav-button active" data-page="home">홈</button>
      <button class="nav-button" data-page="filter">코스 찾기</button>
      <button class="nav-button" data-page="favorites">즐겨찾기</button>
      <button class="nav-button" data-page="records">산책 기록</button>
      <button class="nav-button" data-page="community">커뮤니티</button>
      <button class="nav-button" data-page="mypage">마이페이지</button>
      <button class="nav-button" data-page="about">소개</button>

     </nav>

    </div>

   </header>

   <main class="main-content">
    <div id="home" class="page active">

     <div class="hero">

      <div class="hero-emoji">

       🌸

      </div>

      <h1 class="hero-title" id="main-slogan">당신의 감성을 찾아 떠나는 산책</h1>

      <p class="hero-subtitle" id="main-subtitle">오늘의 기분에 맞는 완벽한 코스를 찾아보세요</p>
      <button class="cta-button" data-page="filter">바로 가기</button>

     </div>

    </div>
    
    <div id="filter" class="page">

     <div class="filter-section">

      <h2 class="section-title" id="filter-title">🔍 나만의 산책로 찾기</h2>

      <div class="filter-group"><label class="filter-label">테마 (감성)</label>

       <div class="filter-options" id="theme-filters">

        <div class="filter-chip" data-filter="theme" data-value="힐링">

         🌿 힐링 

        </div>

        <div class="filter-chip" data-filter="theme" data-value="낭만">

         💕 낭만

        </div>

        <div class="filter-chip" data-filter="theme" data-value="활기">

         ⚡ 활기

        </div>

        <div class="filter-chip" data-filter="theme" data-value="사색">

         📚 사색

        </div>

        <div class="filter-chip" data-filter="theme" data-value="자연">

         🌳 자연

        </div>

       </div>

      </div>

      <div class="filter-group"><label class="filter-label">거리 &amp; 시간</label>

       <div class="filter-options" id="distance-filters">
        
        <div class="filter-chip" data-filter="distance" data-value="짧음">

         ⏱️ 30분 이내

        </div>

        <div class="filter-chip" data-filter="distance" data-value="중간">

         🚶 1시간

        </div>

        <div class="filter-chip" data-filter="distance" data-value="긴">

         🥾 2시간 이상

        </div>

       </div>

      </div>

      <div class="filter-group"><label class="filter-label">주변 시설</label>

       <div class="filter-options" id="facility-filters">

        <div class="filter-chip" data-filter="facility" data-value="카페">

         ☕ 카페

        </div>

        <div class="filter-chip" data-filter="facility" data-value="화장실">

         🚻 화장실

        </div>

        <div class="filter-chip" data-filter="facility" data-value="벤치">

         🪑 벤치

        </div>

        <div class="filter-chip" data-filter="facility" data-value="주차">

         🅿️ 주차

        </div>

       </div>

      </div>

     </div>

     <div id="theme-preview" style="display: none; margin-top: 2rem; padding: 1rem; border-radius: 12px; background: white; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
       
       <h3 id="course-name-preview" style="font-size: 1.5rem; margin-bottom: 1rem; color: #333; text-align: center;"></h3>
       
       <div style="position: relative;">
         <img id="theme-photo" src="" alt="선택한 필터 이미지" style="width: 100%; height: 800px; display: block; object-fit: cover; border-radius: 8px; cursor: pointer;">
         <button id="add-favorite-btn" style="position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.5); color: white; border: none; border-radius: 50%; width: 40px; height: 40px; font-size: 1.5rem; cursor: pointer; display: none;">
             ⭐
         </button>
       </div>
     </div>
     <div class="course-grid" id="course-grid"></div>

     <div class="empty-state" id="empty-state" style="display: none;">

      <div class="empty-emoji">

       🔍

      </div>

      <p>필터를 선택하면 맞춤 코스가 나타납니다</p>

     </div>

    </div>
    
    <div id="detail" class="page">
     <div class="detail-hero" id="detail-hero"></div>
     <div class="detail-content">
      <div class="detail-header">
       <h1 class="detail-title" id="detail-title">낭만 테마 산책로</h1>
       <div class="course-tags" id="detail-tags"><span class="course-tag">🌿 힐링</span> <span class="course-tag">💕 낭만</span></div>
      </div>
      <div class="detail-stats">
       <div class="stat-item"><span class="stat-emoji">📏</span> <span id="detail-distance">5.2km</span></div>
       <div class="stat-item"><span class="stat-emoji">⏱️</span> <span id="detail-time">1시간 30분</span></div>
       <div class="stat-item"><span class="stat-emoji">💪</span> <span id="detail-difficulty">쉬움</span></div>
      </div>
      <div class="detail-section">
       <h3 class="detail-section-title">📍 코스 소개</h3>
       <p class="detail-text" id="detail-description">한강을 따라 걷는 아름다운 노을 산책로입니다. </p>
      </div>
      <div class="detail-section">
       <h3 class="detail-section-title">💡 추천 팁</h3>
       <p class="detail-text" id="detail-tips">• 저녁 5-7시 사이 방문 추천<br> • 편한 운동화 착용<br> • 카메라 필수!</p>
      </div>
      <div class="detail-section">
       <h3 class="detail-section-title">📸 갤러리</h3>
       <div class="gallery" id="theme-gallery-container">
        </div>
      </div><button class="back-button" data-page="filter">← 목록으로 돌아가기</button>
     </div>
    </div>
    
    <div id="favorites" class="page">

     <div class="filter-section">

      <h2 class="section-title">⭐ 즐겨찾기</h2>

      <p class="detail-text" style="margin-bottom: 2rem;">즐겨찾기한 코스 목록입니다. (코스 카드 위의 ⭐ 버튼을 누르면 해제됩니다)</p>

      <div class="course-grid" id="favorites-grid"></div>

      <div class="empty-state" id="favorites-empty" style="display: none;">

       <div class="empty-emoji">

        ⭐

       </div>

       <p>아직 즐겨찾기한 코스가 없습니다.<br>

        코스 찾기에서 마음에 드는 코스를 발견해보세요!</p>

      </div>

     </div>

    </div>
    
    <div id="records" class="page">

     <div class="community-section">

      <h2 class="section-title">📝 나의 산책 기록</h2>

      <div class="post-form">

       <h3 class="detail-section-title">새 산책 기록하기</h3>

       <form id="record-form">

        <div class="form-group"><label for="record-course" class="form-label">산책한 코스</label> <input type="text" id="record-course" class="form-input" placeholder="예: 한강 노을 산책로" required>

        </div>

        <div class="form-group"><label for="record-date" class="form-label">날짜</label> <input type="date" id="record-date" class="form-input" required>

        </div>

        <div class="form-group"><label for="record-duration" class="form-label">소요 시간</label> <input type="text" id="record-duration" class="form-input" placeholder="예: 1시간 30분 (시간과 분을 모두 포함하여 입력해주세요)" required>

        </div>

        <div class="form-group"><label for="record-mood" class="form-label">오늘의 기분</label> <select id="record-mood" class="form-select" required> <option value="">선택하세요</option> <option value="😊 상쾌함">😊 상쾌함</option> <option value="😌 편안함">😌 편안함</option> <option value="💪 활기참">💪 활기참</option> <option value="😴 피곤함">😴 피곤함</option> <option value="🥰 행복함">🥰 행복함</option> </select>

        </div>

        <div class="form-group"><label for="record-memo" class="form-label">메모</label> <textarea id="record-memo" class="form-textarea" placeholder="오늘의 산책을 기록해보세요"></textarea>

        </div>

        <div class="loading-indicator" id="record-loading" style="display: none;"> 저장 중... </div><button type="submit" class="submit-button" id="record-button">📝 기록하기</button>

       </form>

      </div>

      <div>

       <h3 class="detail-section-title">산책 통계</h3>

       <div class="stats-cards">

        <div class="stat-card">

         <div class="stat-card-emoji">

          🚶

         </div>

         <div class="stat-card-value" id="total-walks">

          0회

         </div>

         <div class="stat-card-label">

          총 산책 횟수

         </div>

        </div>

        <div class="stat-card">

         <div class="stat-card-emoji">

          ⏱️

         </div>

         <div class="stat-card-value" id="total-time">

          0시간

         </div>

         <div class="stat-card-label">

          총 산책 시간

         </div>

        </div>

        <div class="stat-card">

         <div class="stat-card-emoji">

          🏆

         </div>

         <div class="stat-card-value" id="favorite-course">

          -

         </div>

         <div class="stat-card-label">

          최애 코스

         </div>

        </div>

       </div>

      </div>

      <div style="margin-top: 3rem;">

       <h3 class="detail-section-title" style="display: flex; justify-content: space-between; align-items: center;">
        <span>기록 목록</span>
        <button id="clear-records-btn" class="back-button" style="padding: 0.4rem 1rem; font-size: 0.8rem; background: #dc3545; color: white;">
         ❌ 기록 전체 삭제
        </button>
       </h3>

       <div class="loading-indicator" id="records-loading" style="display: none;"> 불러오는 중... </div>

       <div class="posts-list" id="records-list"></div>

       <div class="empty-state" id="records-empty" style="display: none;">

        <div class="empty-emoji">

         📝

        </div>

        <p>아직 산책 기록이 없습니다.<br>

         첫 번째 산책을 기록해보세요!</p>

       </div>

      </div>

     </div>

    </div>
    
    <div id="community" class="page">

     <div class="community-section">

      <h2 class="section-title">💬 커뮤니티</h2>

      <div class="post-form">

       <h3 class="detail-section-title">새 글 작성하기</h3>

       <form id="post-form">

        <div class="form-group"><label for="post-type" class="form-label">글 유형</label> <select id="post-type" class="form-select" required> <option value="">선택하세요</option> <option value="후기">🌟 후기</option> <option value="제보">📍 코스 제보</option> <option value="질문">❓ 질문</option> </select>

        </div>

        <div class="form-group"><label for="post-author" class="form-label">닉네임</label> <input type="text" id="post-author" class="form-input" placeholder="닉네임을 입력하세요" required>

        </div>

        <div class="form-group"><label for="post-course" class="form-label">코스 이름 (선택)</label> <input type="text" id="post-course" class="form-input" placeholder="예: 한강 노을 산책로">

        </div>

        <div class="form-group" id="rating-group" style="display: none;"><label for="post-rating" class="form-label">평점</label> <select id="post-rating" class="form-select"> <option value="5">⭐⭐⭐⭐⭐ 최고예요</option> <option value="4">⭐⭐⭐⭐ 좋아요</option> <option value="3">⭐⭐⭐ 괜찮아요</option> <option value="2">⭐⭐ 별로예요</option> <option value="1">⭐ 아쉬워요</option> </select>

        </div>

        <div class="form-group"><label for="post-content" class="form-label">내용</label> <textarea id="post-content" class="form-textarea" placeholder="내용을 입력하세요" required></textarea>

        </div>

        <div class="loading-indicator" id="submit-loading" style="display: none;"> 저장 중... </div><button type="submit" class="submit-button" id="submit-button">✍️ 작성하기</button>

       </form>

      </div>

      <div>

       <h3 class="detail-section-title">최근 게시글</h3>

       <div class="loading-indicator" id="posts-loading" style="display: none;"> 불러오는 중... </div>

       <div class="posts-list" id="posts-list"></div>

       <div class="empty-state" id="posts-empty" style="display: none;">

        <div class="empty-emoji">

         💬

        </div>

        <p>아직 커뮤니티 게시글이 없습니다.<br>

         첫 번째 글을 작성해보세요!</p>

       </div>

      </div>

     </div>

    </div>
    
    <div id="mypage" class="page">
     <div class="community-section">
      <h2 class="section-title">👤 마이페이지</h2>
      <div class="profile-section">
       <h3 class="detail-section-title">프로필 정보</h3>
       <div class="profile-header">
        <div class="profile-avatar"> 🐾 </div>
        <div class="profile-info"> <div class="profile-name" id="profile-name"> 산책러 </div> <div class="profile-bio" id="profile-bio"> 매일 새로운 길을 걷고 싶은 초보 산책인입니다. </div> </div>
        <button class="cta-button" id="edit-profile-btn" style="padding: 0.6rem 1.5rem; font-size: 0.9rem;">프로필 수정</button>
       </div>
       <form id="profile-form" style="margin-top: 1.5rem;">
        <div id="edit-profile-form" style="display: none; padding: 1rem; border: 1px solid #eee; border-radius: 12px; background: white;">
         <h4 class="detail-section-title" style="font-size: 1.1rem; margin-bottom: 1rem;">프로필 수정</h4>
         <div class="form-group"><label for="profile-name-input" class="form-label">닉네임</label> <input type="text" id="profile-name-input" class="form-input" required></div>
         <div class="form-group"><label for="profile-bio-input" class="form-label">자기소개</label> <textarea id="profile-bio-input" class="form-textarea"></textarea></div>
         <button type="submit" class="submit-button" style="padding: 0.6rem 1.5rem; font-size: 0.9rem;">저장</button> 
         <button type="button" class="back-button" id="cancel-edit-btn" style="padding: 0.6rem 1.5rem; font-size: 0.9rem; margin-top: 0;">취소</button>
        </div>
       </form>
      </div>
      <div class="profile-section">
       <h3 class="detail-section-title">나의 활동</h3>
       <div class="activity-grid">
        <div class="activity-card"> <div class="activity-icon"> ⭐ </div> <div class="activity-count" id="activity-favorites"> 0 </div> <div class="activity-label"> 즐겨찾기 </div> </div>
        <div class="activity-card"> <div class="activity-icon"> 📝 </div> <div class="activity-count" id="activity-records"> 0 </div> <div class="activity-label"> 산책 기록 </div> </div>
        <div class="activity-card"> <div class="activity-icon"> 💬 </div> <div class="activity-count" id="activity-posts"> 0 </div> <div class="activity-label"> 커뮤니티 글 </div> </div>
       </div>
      </div>
      <div style="margin-top: 3rem;">
       <h3 class="detail-section-title">선호 테마</h3>
       <div class="preference-tags">
        <span class="preference-tag">기록을 쌓아보세요</span>
       </div>
       <p class="detail-text" style="margin-top: 1rem; color: #999; font-size: 0.9rem;">* 즐겨찾기와 산책 기록을 기반으로 선호 테마가 분석됩니다.</p>
      </div>
     </div>
    </div>
    
    <div id="about" class="page">
     <div class="about-content">
      <h1 class="about-title" id="about-title">🌿 오늘의 산책</h1>
      <div class="about-section">
       <h3 class="about-section-title">✨ 우리의 미션</h3>
       <p class="about-text">🌿 오늘의 산책은 당신의 감성과 기분에 맞는 완벽한 산책 코스를 찾아드립니다. 복잡한 일상에서 벗어나 자연과 함께하는 힐링의 시간을 선물하고자 합니다.</p>
      </div>
      <div class="about-section">
       <h3 class="about-section-title">🎯 주요 기능</h3>
       <ul class="feature-list">
        <li class="feature-item">🔍 <strong>감성 필터</strong> - 오늘의 기분과 테마에 맞는 코스 추천</li>
        <li class="feature-item">⏱️ <strong>시간별 선택</strong> - 30분부터 2시간 이상까지 다양한 길이의 코스</li>
        <li class="feature-item">🏢 <strong>시설 정보</strong> - 카페, 화장실, 벤치, 주차 등 편의시설 안내</li>
        <li class="feature-item">📸 <strong>상세 정보</strong> - 코스, 풍경, 추천 팁 제공</li>
        <li class="feature-item"> <strong>커뮤니티</strong> - 후기 및 새로운 코스 공유</li>
       </ul>
      </div>
      <div class="about-section">
       <h3 class="about-section-title">👥 누구를 위한 서비스인가요?</h3>
       <p class="about-text">산책과 걷기, 힐링에 관심 있는 모든 사람들를 위한 서비스입니다. 바쁜 일상 속에서 잠깐의 여유를 찾고 싶은 분들, 새로운 산책 코스를 발견하고 싶은 분들을 환영합니다.</p>
      </div>
     </div>
    </div>

   </main>

  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
    
            // ----------------------------------------------------
            // 1. 데이터 저장 및 관리 (localStorage 사용)
            // ----------------------------------------------------
            const loadData = (key, defaultValue = []) => JSON.parse(localStorage.getItem(key)) || defaultValue;
            const saveData = (key, data) => localStorage.setItem(key, JSON.stringify(data));

            let favorites = loadData('favorites');
            let records = loadData('records');
            let communityPosts = loadData('communityPosts');
            // 🚨 galleryPhotos 관련 데이터 및 로직은 삭제됨
            let profile = loadData('profile', {
                name: '산책러',
                bio: '매일 새로운 길을 걷고 싶은 초보 산책인입니다.'
            });

            // ----------------------------------------------------
            // 2. 이미지 맵 및 필터 로직
            // ----------------------------------------------------
            const themeImageMap = {
            // 🚨 이미지 파일 경로는 실제 폴더 구조와 일치해야 합니다. (사용자 파일 유지)
            '힐링': '/image/낙산.jpg',        
            '낭만': '/image/한강.jpg',
            '활기': '/image/성숲.JPG',
            '사색': '/image/단풍.jpg',
            '자연': '/image/천2.jpg',
            '짧음': '/image/천.jpg',
            '중간': '/image/한강로.jpg',
            '긴': '/image/한강분수.jpg',
            '카페': '/image/서울숲.jpg',
            '화장실': '/image/낙산.jpg',
            '벤치': '/image/낙산3.jpg',
            '주차': '/image/한강로.jpg'
            };
            
            // 💡 테마별 갤러리 이미지 목록 (기존 기본 사진 로직)
            const themeGalleryMap = {
                '힐링': ['image/낙산.jpg', 'image/천2.jpg', 'image/낙산3.jpg'],
                '낭만': ['image/한강.jpg', 'image/한강로.jpg', 'image/한강.jpg'],
                '활기': ['image/한강.jpg', 'image/서울숲.jpg', 'image/천.jpg'],
                '사색': ['image/성숲.JPG', 'image/낙산.jpg', 'image/단풍.jpg'],
                '자연': ['image/천2.jpg', 'image/천.jpg', 'image/낙산.jpg'],
                '짧음': ['image/천.jpg', 'image/한강.jpg', 'image/천2.jpg'],
                '중간': ['image/한강.jpg', 'image/낙산.jpg', 'image/성숲.JPG'],
                '긴': ['image/한강분수.jpg', 'image/한강.jpg', 'image/낙산3jpg'],
                '카페': ['image/서울숲.jpg', 'image/천.jpg', 'image/한강.jpg'],
                '화장실': ['image/한강로.jpg', 'image/천2.jpg', 'image/낙산.jpg'],
                '벤치': ['image/낙산3.jpg', 'image/한강분수.jpg', 'image/단풍.jpg'],
                '주차': ['image/한강.jpg', 'image/한강.jpg', 'image/천.jpg']
            };


            // 💡 테마별 상세 정보 객체
            const themeDetails = {
                '힐링': {
                    distance: "4.5km",
                    time: "1시간 10분",
                    difficulty: "쉬움",
                    description: "고요한 숲길이나 잔잔한 강변을 따라 걸으며 몸과 마음을 정화시키는 코스입니다. 자연의 소리에 귀 기울이며 스트레스를 해소하세요.",
                    tips: "• 아침이나 해 질 녘 방문 추천\n• 명상 음악이나 팟캐스트 준비\n• 편안하고 느린 걸음 유지"
                },
                '낭만': {
                    distance: "3.2km",
                    time: "50분",
                    difficulty: "매우 쉬움",
                    description: "아름다운 야경이나 꽃길, 분위기 좋은 카페거리를 지나는 코스입니다. 사랑하는 사람과 함께 걷거나, 감성적인 사진을 남기기에 완벽합니다.",
                    tips: "• 저녁 6-8시 사이 방문 추천 (노을 및 야경)\n• 카메라 필수!\n• 데이트 코스로 강력 추천"
                },
                '활기': {
                    distance: "8.8km",
                    time: "2시간 30분",
                    difficulty: "어려움",
                    description: "약간의 오르막이나 계단, 또는 긴 거리를 포함하여 에너지를 발산할 수 있는 코스입니다. 상쾌한 땀을 흘리며 활력을 되찾아보세요.",
                    tips: "• 편한 운동화 착용 및 운동복 준비\n• 수분 보충을 위한 물 필수\n• 빠른 걸음 또는 가벼운 러닝 추천"
                },
                '사색': {
                    distance: "6.0km",
                    time: "1시간 50분",
                    difficulty: "보통",
                    description: "조용하고 고즈넉한 코스입니다. 복잡한 생각을 정리하고 나만의 시간을 갖기에 좋습니다.",
                    tips: "• 이어폰 없이 자연 소리 듣기\n• 메모장과 펜 지참\n• 혼자 걷는 것을 추천"
                },
                '자연': {
                    distance: "7.1km",
                    time: "2시간 10분",
                    difficulty: "보통",
                    description: "울창한 숲, 푸른 바다, 넓은 들판 등 자연 경관이 뛰어난 코스입니다. 도심을 벗어나 진정한 자연 속 힐링을 경험해보세요.",
                    tips: "• 계절별 풍경이 아름다운 곳\n• 벌레 퇴치제 준비\n• 흙길이 많으니 등산화 착용 추천"
                },
                '짧음': {
                    distance: "1.5km",
                    time: "25분",
                    difficulty: "매우 쉬움",
                    description: "30분 이내로 가볍게 걸을 수 있는 공원 산책로입니다. 점심 시간이나 잠깐의 휴식 시간에 부담 없이 즐기세요.",
                    tips: "• 짧지만 알찬 코스\n• 가볍게 옷 입고 가기\n• 근처 편의점 이용 편리"
                },
                '중간': {
                    distance: "3.8km",
                    time: "1시간 5분",
                    difficulty: "쉬움",
                    description: "1시간 내외로 적당한 운동량을 확보할 수 있는 코스입니다. 일상적인 운동이나 약속 전후 시간을 활용하기 좋습니다.",
                    tips: "• 친구와 대화하며 걷기 좋음\n• 간단한 간식 준비\n• 걷기 좋은 평탄한 길"
                },
                '긴': {
                    distance: "10.5km",
                    time: "3시간 00분",
                    difficulty: "매우 어려움",
                    description: "2시간 이상 소요되는 장거리 트레킹 코스입니다. 체력 단련과 함께 코스의 모든 매력을 깊이 있게 탐험할 수 있습니다.",
                    tips: "• 충분한 휴식 시간 계획\n• 에너지 바 및 충분한 물 준비\n• 지도 앱 미리 확인 필수"
                },
                '카페': {
                    distance: "2.5km",
                    time: "40분",
                    difficulty: "쉬움",
                    description: "산책로 근처에 유명하거나 분위기 좋은 카페가 있는 코스입니다. 산책 후 달콤한 휴식을 즐길 수 있습니다.",
                    tips: "• 카페 영업 시간 확인\n• 산책 전후 커피 한 잔의 여유\n• 벤치보다 카페에서 쉬는 것을 선호할 때"
                },
                '화장실': {
                    distance: "5.0km",
                    time: "1시간 20분",
                    difficulty: "보통",
                    description: "산책 도중 접근 가능한 공공 화장실 시설이 잘 갖춰진 코스입니다. 긴 산책도 걱정 없이 즐길 수 있습니다.",
                    tips: "• 화장실 위치 미리 확인\n• 깨끗한 시설이 필요할 때\n• 어린이/노약자 동반 시 추천"
                },
                '벤치': {
                    distance: "3.0km",
                    time: "55분",
                    difficulty: "매우 쉬움",
                    description: "휴식을 취할 수 있는 벤치나 쉼터가 충분히 마련된 코스입니다. 쉬엄쉬엄 여유로운 산책을 즐기기에 좋습니다.",
                    tips: "• 책이나 간식 싸가기 좋음\n• 경치 좋은 곳에서 휴식 추천\n• 잠시 멈춰 풍경 감상"
                },
                '주차': {
                    distance: "4.2km",
                    time: "1시간 15분",
                    difficulty: "쉬움",
                    description: "산책로 입구 근처에 주차 시설이 완비된 코스입니다. 차량으로 이동하여 편리하게 산책을 시작할 수 있습니다.",
                    tips: "• 주차 요금 확인 필수\n• 대중교통 이용이 불편할 때 추천\n• 짐이 많을 때 편리함"
                }
            };

            const allChips = document.querySelectorAll('.filter-chip');
            const preview = document.getElementById('theme-preview');
            const photo = document.getElementById('theme-photo');
            const favoriteButton = document.getElementById('add-favorite-btn');
            const courseNamePreview = document.getElementById('course-name-preview');

            let lastSelectedValue = null; 

            // 💡 필터 상태 업데이트 로직 (랜덤 선택 적용 및 코스 이름 표시)
            function updateFilterState() {
                const selectedChips = document.querySelectorAll('.filter-chip.selected');
                
                if (!photo || !preview || !favoriteButton || !courseNamePreview) return; 

                if (selectedChips.length > 0) {
                    preview.style.display = 'block';
                    
                    const selectedChipsArray = Array.from(selectedChips);
                    
                    // 💡 핵심: 선택된 칩 배열에서 무작위로 하나를 선택합니다.
                    const randomIndex = Math.floor(Math.random() * selectedChipsArray.length);
                    const selectedChipForImage = selectedChipsArray[randomIndex];

                    if (selectedChipForImage) {
                        lastSelectedValue = selectedChipForImage.getAttribute('data-value');
                        const src = themeImageMap[lastSelectedValue];
                        
                        const courseName = `${lastSelectedValue} 테마 산책로`; 

                        if (src) {
                            photo.src = src;
                            photo.alt = lastSelectedValue;
                            favoriteButton.style.display = 'inline-flex'; 
                            favoriteButton.setAttribute('data-course', courseName);
                            
                            courseNamePreview.textContent = courseName; 
                        } else {
                            photo.src = ''; 
                            favoriteButton.style.display = 'none';
                            courseNamePreview.textContent = lastSelectedValue; 
                        }
                    } else {
                        preview.style.display = 'none';
                        favoriteButton.style.display = 'none';
                        courseNamePreview.textContent = '';
                    }
                } else {
                    preview.style.display = 'none';
                    photo.src = ''; 
                    favoriteButton.style.display = 'none';
                    lastSelectedValue = null;
                    courseNamePreview.textContent = ''; 
                }
            }

            allChips.forEach(chip => {
            chip.addEventListener('click', () => {
                chip.classList.toggle('selected'); // 다중 선택 허용
                updateFilterState();
            });
            });

            // 💡 갤러리 사진 렌더링 함수 (기본 사진 3개로 복원)
            function renderGallery(themeName) { 
                const container = document.getElementById('theme-gallery-container');
                if (!container) return;
                
                const photos = themeGalleryMap[themeName] || [];
                
                if (photos.length === 0) {
                    container.innerHTML = `
                        <div class="gallery-item">🖼️</div>
                        <div class="gallery-item">📸</div>
                        <div class="gallery-item">📍</div>
                    `;
                    return;
                }
                
                let html = photos.map(url => `
                    <div class="gallery-item">
                        <img src="${url}" alt="Gallery photo" style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px;">
                    </div>
                `).join('');
                
                container.innerHTML = html;
            }

            // 💡 코스 사진 클릭 시 detail 페이지로 이동 및 상세 설명 동적 업데이트
            if (photo) {
                photo.addEventListener('click', () => {
                    if (lastSelectedValue) {
                        showPage('detail');
                        const courseName = courseNamePreview.textContent;
                        
                        const detail = themeDetails[lastSelectedValue] || {
                            distance: '정보 없음',
                            time: '정보 없음',
                            difficulty: '정보 없음',
                            description: "선택한 테마의 상세 정보가 아직 없습니다.",
                            tips: "• 코스 개발 중입니다.\n• 잠시 후 다시 시도해 주세요."
                        };

                        document.getElementById('detail-title').textContent = courseName;
                        document.getElementById('detail-description').textContent = detail.description;
                        document.getElementById('detail-tips').innerHTML = detail.tips.replace(/\n/g, '<br>');
                        
                        document.getElementById('detail-distance').textContent = detail.distance || '정보 없음';
                        document.getElementById('detail-time').textContent = detail.time || '정보 없음';
                        document.getElementById('detail-difficulty').textContent = detail.difficulty || '정보 없음';

                        const detailHero = document.getElementById('detail-hero');
                        const imagePath = themeImageMap[lastSelectedValue];
                        
                        if (detailHero && imagePath) {
                            detailHero.style.backgroundImage = `url('${imagePath}')`;
                            detailHero.style.backgroundSize = 'cover';
                            detailHero.style.backgroundPosition = 'center';
                            detailHero.style.minHeight = '300px';
                            detailHero.style.marginBottom = '20px';
                            detailHero.style.borderRadius = '12px';
                        }
                        
                        // 갤러리 기본 사진 렌더링
                        renderGallery(lastSelectedValue); 
                    }
                });
            }


            // ----------------------------------------------------
            // 3. 즐겨찾기 추가/렌더링 로직
            // ----------------------------------------------------
            if (favoriteButton) { 
            favoriteButton.addEventListener('click', () => {
                if (!lastSelectedValue) return;

                const courseName = courseNamePreview.textContent; 
                const existing = favorites.some(fav => fav.name === courseName);

                if (existing) {
                    alert(`${courseName}는 이미 즐겨찾기에 있습니다!`);
                    return;
                }

                const newFavorite = {
                    id: Date.now(),
                    name: courseName,
                    theme: lastSelectedValue,
                    image: themeImageMap[lastSelectedValue], 
                    date: new Date().toLocaleDateString('ko-KR')
                };

                favorites.push(newFavorite);
                saveData('favorites', favorites);
                alert(`${courseName}이(가) 즐겨찾기에 추가되었습니다.`);
                renderFavorites(); 
            });
            }

            const favoritesGrid = document.getElementById('favorites-grid');
            const favoritesEmpty = document.getElementById('favorites-empty');

            function renderFavorites() {
                if (!favoritesGrid) return;

                if (favorites.length === 0) {
                    favoritesEmpty.style.display = 'flex';
                    favoritesGrid.innerHTML = '';
                    return;
                }
                favoritesEmpty.style.display = 'none';

                let html = favorites.map(fav => `
                    <div class="course-card" data-course-id="${fav.id}">
                        <div class="course-image-wrapper">
                            <img src="${fav.image}" alt="${fav.name}" class="course-image">
                            <button class="favorite-toggle active" data-id="${fav.id}">⭐</button>
                        </div>
                        <div class="course-info">
                            <h4 class="course-title">${fav.name}</h4>
                            <p class="course-theme">${fav.theme}</p>
                            <p class="course-date">추가일: ${fav.date}</p>
                        </div>
                    </div>
                `).join('');
                favoritesGrid.innerHTML = html;

                document.querySelectorAll('.favorite-toggle').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const idToRemove = parseInt(e.currentTarget.getAttribute('data-id'));
                        favorites = favorites.filter(fav => fav.id !== idToRemove);
                        saveData('favorites', favorites);
                        renderFavorites(); 
                        renderMypageActivity(); 
                        alert('즐겨찾기에서 해제되었습니다.');
                    });
                });
            }

            // ----------------------------------------------------
            // 4. 산책 기록/커뮤니티 렌더링 및 폼 제출 로직
            // ----------------------------------------------------
            
            function calculateWalkStats() {
              let totalWalks = records.length;
              let totalMinutes = 0;
              let courseCounts = {}; 

              records.forEach(record => {
                  let duration = record.duration;
                  let hours = 0;
                  let minutes = 0;

                  const hourMatch = duration.match(/(\d+)\s*시간/);
                  if (hourMatch) {
                      hours = parseInt(hourMatch[1]);
                  }

                  const minuteMatch = duration.match(/(\d+)\s*분/);
                  if (minuteMatch) {
                      minutes = parseInt(minuteMatch[1]);
                  }
                  
                  totalMinutes += (hours * 60) + minutes;

                  const courseName = record.course;
                  courseCounts[courseName] = (courseCounts[courseName] || 0) + 1;
              });

              const displayHours = Math.floor(totalMinutes / 60);
              const displayMinutes = totalMinutes % 60;
              let displayTime = '';

              if (displayHours > 0) {
                  displayTime += `${displayHours}시간 `;
              }
              if (displayMinutes > 0 || totalMinutes === 0) {
                  displayTime += `${displayMinutes}분`;
              }
              displayTime = displayTime.trim();

              let favoriteCourse = '-';
              let maxCount = 0;
              for (const course in courseCounts) {
                  if (courseCounts[course] > maxCount) {
                      maxCount = courseCounts[course];
                      favoriteCourse = course;
                  }
              }

              return {
                  totalWalks: totalWalks,
                  totalTime: displayTime,
                  favoriteCourse: favoriteCourse
              };
            }

            const recordsList = document.getElementById('records-list');
            const recordsEmpty = document.getElementById('records-empty');
            const recordForm = document.getElementById('record-form');
            
            function renderRecords() {
                if (!recordsList) return;
                
                const stats = calculateWalkStats();
                
                const totalWalksEl = document.getElementById('total-walks');
                const totalTimeEl = document.getElementById('total-time');
                const favoriteCourseEl = document.getElementById('favorite-course');

                if(totalWalksEl) totalWalksEl.textContent = `${stats.totalWalks}회`;
                if(totalTimeEl) totalTimeEl.textContent = stats.totalTime || '0시간 0분';
                if(favoriteCourseEl) favoriteCourseEl.textContent = stats.favoriteCourse;
                
                if (records.length === 0) {
                    recordsEmpty.style.display = 'flex';
                    recordsList.innerHTML = '';
                    return;
                }
                recordsEmpty.style.display = 'none';

                
                let html = records.map(record => `
                    <div class="post-card">
                        <div class="post-header">
                            <span class="post-type">📝 기록</span>
                            <span class="post-date">${record.date}</span>
                        </div>
                        <h4 class="post-title">${record.course} (${record.duration})</h4>
                        <p class="post-content">${record.memo}</p>
                        <div class="post-footer">
                            <span class="post-author">${record.mood}</span>
                        </div>
                    </div>
                `).join('');
                recordsList.innerHTML = html;
                renderMypageActivity(); 
            }

            if (recordForm) {
                recordForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    
                    const newRecord = {
                        id: Date.now(),
                        course: document.getElementById('record-course').value,
                        date: document.getElementById('record-date').value,
                        duration: document.getElementById('record-duration').value,
                        mood: document.getElementById('record-mood').value,
                        memo: document.getElementById('record-memo').value
                    };
                    
                    records.unshift(newRecord); 
                    saveData('records', records);
                    renderRecords(); 

                    alert('산책 기록이 성공적으로 작성되었습니다.');
                    recordForm.reset(); 
                });
            }
            
            // 💡 기록 전체 삭제 기능 구현
            const clearRecordsBtn = document.getElementById('clear-records-btn');

            if (clearRecordsBtn) {
                clearRecordsBtn.addEventListener('click', () => {
                    if (confirm('정말로 모든 산책 기록을 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다.')) {
                        localStorage.removeItem('records');
                        records = []; 
                        renderRecords();
                        alert('모든 산책 기록이 삭제되었습니다.');
                    }
                });
            }


            const postsList = document.getElementById('posts-list');
            const postsEmpty = document.getElementById('posts-empty');
            const postForm = document.getElementById('post-form');
            const postTypeSelect = document.getElementById('post-type');
            const ratingGroup = document.getElementById('rating-group');

            if (postTypeSelect) {
                postTypeSelect.addEventListener('change', (e) => {
                    ratingGroup.style.display = e.target.value === '후기' ? 'block' : 'none';
                });
            }
            
            // 💡 커뮤니티 게시글 렌더링 및 삭제 기능 추가
            function renderCommunityPosts() {
                if (!postsList) return;
                if (communityPosts.length === 0) {
                    postsEmpty.style.display = 'flex';
                    postsList.innerHTML = '';
                    return;
                }
                postsEmpty.style.display = 'none';
                
                let html = communityPosts.map(post => {
                    const ratingHtml = post.rating ? `
                        <div class="post-rating">
                            ${'⭐'.repeat(parseInt(post.rating))} (${post.rating}점)
                        </div>
                    ` : '';

                    return `
                        <div class="post-card" data-post-id="${post.id}">
                            <div class="post-header" style="display: flex; justify-content: space-between; align-items: center;"> 
                                <div>
                                    <span class="post-type">${post.type}</span>
                                    <span class="post-date">${post.date}</span>
                                </div>
                                <button class="delete-post-btn" data-id="${post.id}" style="font-size: 0.8rem; padding: 0.2rem 0.5rem; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                    삭제
                                </button>
                            </div>
                            <h4 class="post-title">${post.course ? post.course : '코스 정보 없음'}</h4>
                            <p class="post-content">${post.content}</p>
                            <div class="post-footer">
                                <span class="post-author">작성자: ${post.author}</span>
                                ${ratingHtml}
                            </div>
                        </div>
                    `;
                }).join('');
                postsList.innerHTML = html;
                
                document.querySelectorAll('.delete-post-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const idToRemove = parseInt(e.currentTarget.getAttribute('data-id'));
                        if (confirm('정말로 이 게시글을 삭제하시겠습니까?')) {
                            communityPosts = communityPosts.filter(post => post.id !== idToRemove);
                            saveData('communityPosts', communityPosts);
                            renderCommunityPosts();
                            alert('게시글이 삭제되었습니다.');
                        }
                    });
                });

                renderMypageActivity();
            }

            if (postForm) {
                postForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    
                    const type = document.getElementById('post-type').value;
                    const newPost = {
                        id: Date.now(),
                        type: type,
                        author: document.getElementById('post-author').value,
                        course: document.getElementById('post-course').value,
                        content: document.getElementById('post-content').value,
                        date: new Date().toLocaleDateString('ko-KR'),
                        rating: type === '후기' ? document.getElementById('post-rating').value : null
                    };
                    
                    communityPosts.unshift(newPost); 
                    saveData('communityPosts', communityPosts);
                    renderCommunityPosts(); 
                    
                    alert('게시글이 성공적으로 작성되었습니다.');
                    postForm.reset(); 
                    ratingGroup.style.display = 'none'; 
                });
            }


            // ----------------------------------------------------
            // 5. 마이페이지 (프로필 수정 및 선호 테마 분석) 로직
            // ----------------------------------------------------
            
            function calculateFavoriteThemes() {
              const themeCounts = {};
              
              favorites.forEach(fav => {
                const theme = fav.theme;
                themeCounts[theme] = (themeCounts[theme] || 0) + 1;
              });

              records.forEach(record => {
                const mood = record.mood.split(' ')[1] || record.mood; 
                themeCounts[mood] = (themeCounts[mood] || 0) + 1;
              });

              const sortedThemes = Object.keys(themeCounts)
                .sort((a, b) => themeCounts[b] - themeCounts[a]);

              return sortedThemes.slice(0, 3);
            }
            
            function renderMypageActivity() {
              if (document.getElementById('activity-favorites')) {
                  document.getElementById('activity-favorites').textContent = favorites.length;
              }
              if (document.getElementById('activity-records')) {
                  document.getElementById('activity-records').textContent = records.length;
              }
              if (document.getElementById('activity-posts')) {
                  document.getElementById('activity-posts').textContent = communityPosts.length;
              }
              
              const favoriteThemes = calculateFavoriteThemes();
              const preferenceTagsDiv = document.querySelector('#mypage .preference-tags');
              if (preferenceTagsDiv) {
                if (favoriteThemes.length === 0) {
                     preferenceTagsDiv.innerHTML = '<span class="preference-tag" style="background: #ccc;">기록을 쌓아보세요</span>';
                } else {
                     preferenceTagsDiv.innerHTML = favoriteThemes.map(theme => 
                        `<span class="preference-tag">${theme}</span>`
                     ).join('');
                }
              }
            }

            function renderMypage() {
                if (!document.getElementById('profile-name')) return;
                
                document.getElementById('profile-name').textContent = profile.name;
                document.getElementById('profile-bio').textContent = profile.bio;

                const nameInput = document.getElementById('profile-name-input');
                const bioInput = document.getElementById('profile-bio-input');
                if (nameInput) nameInput.value = profile.name;
                if (bioInput) bioInput.value = profile.bio;

                renderMypageActivity();
            }
            
            const editProfileBtn = document.getElementById('edit-profile-btn');
            const cancelEditBtn = document.getElementById('cancel-edit-btn');
            const editProfileForm = document.getElementById('edit-profile-form');
            const profileForm = document.getElementById('profile-form');

            if (editProfileBtn) {
                editProfileBtn.addEventListener('click', () => {
                    editProfileForm.style.display = 'block';
                    editProfileBtn.style.display = 'none';
                });
            }

            if (cancelEditBtn) {
                cancelEditBtn.addEventListener('click', () => {
                    editProfileForm.style.display = 'none';
                    editProfileBtn.style.display = 'inline-block';
                });
            }

            if (profileForm) {
                profileForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const newName = document.getElementById('profile-name-input').value;
                    const newBio = document.getElementById('profile-bio-input').value;

                    profile.name = newName;
                    profile.bio = newBio;
                    saveData('profile', profile);
                    
                    alert('프로필이 성공적으로 수정되었습니다.');
                    editProfileForm.style.display = 'none';
                    editProfileBtn.style.display = 'inline-block';
                    renderMypage(); 
                });
            }


            // ----------------------------------------------------
            // 6. 페이지 전환 로직
            // ----------------------------------------------------
            function showPage(pageId) {
                const pages = document.querySelectorAll('.page');
                const navButtons = document.querySelectorAll('.nav-button');

                pages.forEach(page => page.classList.remove('active'));

                const targetPage = document.getElementById(pageId);
                if (targetPage) {
                    targetPage.classList.add('active');
                }

                navButtons.forEach(button => {
                    button.classList.remove('active');
                    if (button.getAttribute('data-page') === pageId) {
                        button.classList.add('active');
                    }
                });
                
                if (pageId === 'filter') {
                    updateFilterState(); 
                } else if (pageId === 'records') {
                    renderRecords();
                } else if (pageId === 'community') {
                    renderCommunityPosts();
                } else if (pageId === 'favorites') {
                    renderFavorites();
                } else if (pageId === 'mypage') {
                    renderMypage(); 
                }
            }

            const clickableElements = document.querySelectorAll('[data-page]');
            
            clickableElements.forEach(element => {
                element.addEventListener('click', (e) => {
                    const pageId = e.currentTarget.getAttribute('data-page');
                    if (document.startViewTransition) {
                        document.startViewTransition(() => showPage(pageId));
                    } else {
                        showPage(pageId);
                    }
                });
            });

            showPage('home');

            renderRecords();
            renderCommunityPosts();
            renderFavorites();
            renderMypageActivity(); 
        });
    </script>

 </body>
</html>